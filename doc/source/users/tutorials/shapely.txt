.. testsetup:: *
        
        import pysal
        import numpy as np

###########################################
Using PySAL with Shapely for GIS Operations
###########################################


.. versionadded:: 1.3

Introduction
============

The `Shapely <http://pypi.python.org/pypi/Shapely>`_ project is a BSD-licensed
Python package for manipulation and analysis of planar geometric objects, and
depends on the widely used GEOS library.

PySAL supports interoperation with the Shapely library through Shapely's Python
Geo Interface. All PySAL geometries provide a __geo_interface__ property which
models the geometries as a GeoJSON object. Shapely geometry objects also export
the __geo_interface__ property and can be adapted to PySAL geometries using
the :py:func:`pysal.cg.asShape` function.

Additionally, PySAL provides an optional contrib module that handles the
conversion between pysal and shapely data strucutures for you.  The module can
be found in at, :py:mod:`pysal.contrib.shapely_ext`.

Installation
============

Please refer to the `Shapely <http://pypi.python.org/pypi/Shapely>`_
website for instructions on installing Shapely and its
dependencies, *without which PySAL's Shapely extension will not work.*

Usage
=====

Using the Python Geo Interface...

.. doctest::

    >>> import pysal
    >>> import shapely.geometry
    >>> # The get_path function returns the absolute system path to pysal's
    >>> # included example files no matter where they are installed on the system.
    >>> fpath = pysal.examples.get_path('stl_hom.shp')
    >>> # Now, open the shapefile using pysal's FileIO
    >>> shps = pysal.open(fpath , 'r')
    >>> # We can read all the polygons into a list...
    >>> polygons = shps.read()
    >>> # To use these polygons with shapely we simply convert them with
    >>> # Shapely's asShape method.
    >>> polygons = map(shapely.geometry.asShape, polygons)
    >>> # now we can operate on our polygons like normal shapely objects...
    >>> total_area = sum([poly.area for poly in polygons])
    >>> print "%.4f"%total_area
    11.9842
    >>> eroded_polygons = [poly.buffer(-0.01) for poly in polygons]
    >>> total_area = sum([poly.area for poly in eroded_polygons])
    >>> print "%.4f"%total_area
    10.6538



